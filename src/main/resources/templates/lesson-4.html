<!DOCTYPE html>
<html lang="id" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout}">

<head>
    <title>Pelajaran 4: Todo List CRUD</title>
</head>

<body>
    <div layout:fragment="content">
        <!-- Lesson Header -->
        <div class="mb-8">
            <div class="flex items-center gap-3 mb-3">
                <span
                    class="flex items-center justify-center w-12 h-12 rounded-xl bg-blue-100 text-blue-600 text-2xl shadow-sm">
                    4Ô∏è‚É£
                </span>
                <h2 class="text-3xl font-extrabold text-gray-900 tracking-tight">Todo List CRUD Operations</h2>
            </div>
            <p class="text-xl text-gray-600 max-w-3xl leading-relaxed">
                Membangun aplikasi full CRUD (Create, Read, Update, Delete) yang persisten di database, menggunakan
                semua HTTP verbs (<code
                    class="bg-primary-50 text-primary-700 px-1.5 py-0.5 rounded text-sm font-mono border border-primary-100">POST</code>,
                <code
                    class="bg-primary-50 text-primary-700 px-1.5 py-0.5 rounded text-sm font-mono border border-primary-100">PUT</code>,
                <code
                    class="bg-primary-50 text-primary-700 px-1.5 py-0.5 rounded text-sm font-mono border border-primary-100">DELETE</code>).
            </p>
        </div>

        <!-- Lesson Overview -->
        <div class="card mb-8 border-l-4 border-l-blue-500">
            <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
                <span>üìö</span> Konsep Utama
            </h3>

            <div class="space-y-6">
                <p class="text-gray-600 leading-relaxed">
                    Kita akan membuat Todo List yang fungsional. HTMX menangani interaksi frontend untuk mengubah state
                    tanpa reload, sementara Spring Boot dan H2 Database menangani persistensi data di backend.
                </p>

                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-gray-50 rounded-xl p-5 border border-gray-100">
                        <p class="font-semibold text-gray-900 mb-3 flex items-center gap-2">
                            <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4">
                                </path>
                            </svg>
                            Operasi HTMX
                        </p>
                        <ul class="space-y-3">
                            <li class="flex items-start gap-2 text-sm text-gray-600">
                                <code
                                    class="bg-white px-1.5 py-0.5 rounded border border-gray-200 text-xs font-mono text-blue-600 min-w-[140px]">hx-post="/todos"</code>
                                <span><strong>Create:</strong> Kirim form untuk buat item baru.</span>
                            </li>
                            <li class="flex items-start gap-2 text-sm text-gray-600">
                                <code
                                    class="bg-white px-1.5 py-0.5 rounded border border-gray-200 text-xs font-mono text-blue-600 min-w-[140px]">hx-put="/todos/{id}"</code>
                                <span><strong>Update:</strong> Toggle status selesai (checkbox).</span>
                            </li>
                            <li class="flex items-start gap-2 text-sm text-gray-600">
                                <code
                                    class="bg-white px-1.5 py-0.5 rounded border border-gray-200 text-xs font-mono text-blue-600 min-w-[140px]">hx-delete="/todos/{id}"</code>
                                <span><strong>Delete:</strong> Hapus item dari list.</span>
                            </li>
                        </ul>
                    </div>

                    <div class="bg-gray-50 rounded-xl p-5 border border-gray-100">
                        <p class="font-semibold text-gray-900 mb-3 flex items-center gap-2">
                            <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4">
                                </path>
                            </svg>
                            Database & Pola Hapus
                        </p>
                        <ul class="space-y-3">
                            <li class="flex items-start gap-2 text-sm text-gray-600">
                                <span
                                    class="bg-white px-1.5 py-0.5 rounded border border-gray-200 text-xs font-bold text-gray-600 min-w-[24px] text-center">1</span>
                                <span>Data disimpan di <strong>H2 Database</strong> (file-based).</span>
                            </li>
                            <li class="flex items-start gap-2 text-sm text-gray-600">
                                <span
                                    class="bg-white px-1.5 py-0.5 rounded border border-gray-200 text-xs font-bold text-gray-600 min-w-[24px] text-center">2</span>
                                <span>Saat <strong>DELETE</strong> berhasil, server return status <code>200 OK</code>
                                    dengan body kosong.</span>
                            </li>
                            <li class="flex items-start gap-2 text-sm text-gray-600">
                                <span
                                    class="bg-white px-1.5 py-0.5 rounded border border-gray-200 text-xs font-bold text-gray-600 min-w-[24px] text-center">3</span>
                                <span>HTMX menerima body kosong dan otomatis menghapus elemen target dari DOM.</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Interactive Demo -->
        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
            <span>üéÆ</span> Demo Interaktif
        </h3>

        <div class="grid lg:grid-cols-3 gap-8 mb-8">
            <div class="lg:col-span-1 space-y-6">
                <!-- Instructions -->
                <div class="card bg-amber-50 border-amber-100">
                    <p class="font-bold text-amber-900 mb-2 flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                        Misi:
                    </p>
                    <ul class="space-y-2 text-sm text-amber-800 list-disc list-outside ml-4">
                        <li>Buat Todo baru (misal: "Belajar HTMX").</li>
                        <li>Klik <strong>Checkbox</strong> untuk menandai selesai.</li>
                        <li>Klik tombol <strong>‚ùå</strong> untuk menghapus.</li>
                        <li>Refresh halaman untuk membuktikan data tersimpan!</li>
                    </ul>
                </div>
                <!-- H2 Console Link -->
                <div class="card bg-purple-50 border-purple-100 p-4">
                    <p class="font-bold text-purple-900 mb-2 flex items-center gap-2 text-sm">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4">
                            </path>
                        </svg>
                        Cek Database
                    </p>
                    <p class="text-xs text-purple-800 mb-3">
                        Lihat data mentah di H2 Console. <br>
                        JDBC URL: <code>jdbc:h2:file:./data/belajardb</code>
                    </p>
                    <a href="/h2-console" target="_blank"
                        class="btn btn-sm bg-purple-600 text-white hover:bg-purple-700 w-full justify-center">Buka H2
                        Console</a>
                </div>
            </div>

            <!-- Todo Widget -->
            <div class="lg:col-span-2">
                <div class="card min-h-[400px] flex flex-col p-0 overflow-hidden">
                    <div
                        class="bg-gradient-to-r from-blue-600 to-indigo-600 px-6 py-4 flex justify-between items-center text-white">
                        <h4 class="font-bold text-lg">My Tasks</h4>
                        <span class="text-xs bg-white/20 px-2 py-1 rounded">HTMX Powered</span>
                    </div>
                    <div id="todo-widget-container" class="flex-1 bg-white p-6">
                        <div hx-get="/todos" hx-trigger="load" hx-target="#todo-widget-container"
                            class="flex flex-col items-center justify-center h-full text-gray-400">
                            <div class="animate-spin text-3xl mb-3">‚è≥</div>
                            <p class="text-sm">Memuat daftar tugas...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Code Explanation -->
        <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
            <span>üìù</span> Bedah Kode
        </h3>

        <div class="grid lg:grid-cols-2 gap-8 mb-8">
            <!-- Controller -->
            <div class="card bg-gray-900 text-gray-300 border-gray-800">
                <div class="flex items-center justify-between mb-4 border-b border-gray-800 pb-2">
                    <h3 class="font-semibold text-white flex items-center gap-2">
                        <span>Controller (Backend)</span>
                    </h3>
                    <span
                        class="text-xs font-mono bg-gray-800 px-2 py-1 rounded text-gray-400">TodoController.java</span>
                </div>
                <div class="font-mono text-sm leading-relaxed overflow-x-auto">
                    <pre><code class="language-java">// DELETE: Hapus Todo
@DeleteMapping("/{id}")
public ResponseEntity&lt;Void&gt; delete(@PathVariable Long id) {
    todoService.delete(id);
    // Return 200 OK with empty body
    // HTMX removes element from DOM
    <span class="text-blue-400">return ResponseEntity.ok().build();</span>
}

// PUT: Toggle Status
@PutMapping("/{id}/toggle")
public String toggle(@PathVariable Long id, Model model) {
    // Only return the updated ITEM fragment
    <span class="text-green-400">return "fragments/todo-item";</span>
}</code></pre>
                </div>
            </div>

            <!-- Frontend -->
            <div class="card bg-gray-900 text-gray-300 border-gray-800">
                <div class="flex items-center justify-between mb-4 border-b border-gray-800 pb-2">
                    <h3 class="font-semibold text-white flex items-center gap-2">
                        <span>Frontend (Thymeleaf)</span>
                    </h3>
                    <span class="text-xs font-mono bg-gray-800 px-2 py-1 rounded text-gray-400">todo-item.html</span>
                </div>
                <div class="font-mono text-sm leading-relaxed overflow-x-auto">
                    <pre><code class="language-html">&lt;!-- Delete Button --&gt;
&lt;button
    <span class="text-red-400">th:hx-delete</span>="'/todos/' + ${todo.id}"
    <span class="text-secondary-400">hx-target</span>="closest li"
    <span class="text-secondary-400">hx-swap</span>="outerHTML"
    <span class="text-yellow-400">hx-confirm</span>="Yakin hapus?"&gt;
    ‚ùå
&lt;/button&gt;

&lt;!-- Notes: --&gt;
&lt;!-- target='closest li' means delete the list row --&gt;
&lt;!-- swap='outerHTML' + empty response = element removed --&gt;</code></pre>
                </div>
            </div>
        </div>

        <!-- Key Takeaways -->
        <div class="card bg-gradient-to-br from-green-50 to-emerald-50 border-l-4 border-green-500 mb-8">
            <h3 class="text-lg font-bold text-green-900 mb-3 flex items-center gap-2">
                <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                Poin Penting
            </h3>
            <ul class="grid sm:grid-cols-2 gap-3 text-sm text-green-800">
                <li class="flex items-start gap-2">
                    <span class="text-green-500 mt-1">‚óè</span>
                    <span><strong>RESTful HTMX:</strong> Gunakan verb HTTP yang tepat (POST, PUT, DELETE) bukan hanya
                        POST untuk semua aksi.</span>
                </li>
                <li class="flex items-start gap-2">
                    <span class="text-green-500 mt-1">‚óè</span>
                    <span><strong>Targeting:</strong> <code>hx-target="closest li"</code> sangat powerful untuk operasi
                        pada list item.</span>
                </li>
                <li class="flex items-start gap-2">
                    <span class="text-green-500 mt-1">‚óè</span>
                    <span><strong>Delete Logic:</strong> Return HTTP 200 kosong untuk menghapus elemen via HTMX.</span>
                </li>
                <li class="flex items-start gap-2">
                    <span class="text-green-500 mt-1">‚óè</span>
                    <span><strong>Thymeleaf URLs:</strong> Gunakan <code>th:hx-*</code> saat URL butuh ID dinamis dari
                        database.</span>
                </li>
            </ul>
        </div>

        <!-- Navigation -->
        <div class="flex justify-between items-center border-t border-gray-200 pt-6">
            <a href="/lesson/3" class="btn btn-ghost flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                Pelajaran 3
            </a>
            <a href="/lesson/5" class="btn btn-primary flex items-center gap-2 shadow-lg shadow-primary-500/20">
                Lanjut ke Pelajaran 5
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3">
                    </path>
                </svg>
            </a>
        </div>
    </div>
</body>

</html>