<!DOCTYPE html>
<html lang="id" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>Pelajaran 7: HTMX + Alpine Combination</title>
</head>
<body>
    <div layout:fragment="content">
        <!-- Lesson Header -->
        <div class="mb-6">
            <div class="flex items-center space-x-3 mb-2">
                <span class="text-4xl">7Ô∏è‚É£</span>
                <h2 class="text-3xl font-bold text-gray-900">Pelajaran 7: Kombinasi HTMX + Alpine.js</h2>
            </div>
            <p class="text-gray-600 text-lg">
                Menggabungkan kekuatan HTMX (server sync) dengan Alpine.js (client-side UI) untuk UX optimal
            </p>
        </div>

        <!-- Lesson Overview -->
        <div class="card bg-indigo-50 border-l-4 border-indigo-500 mb-6">
            <h3 class="text-xl font-bold text-indigo-900 mb-3">üìö Konsep Pelajaran 7</h3>

            <div class="space-y-3 text-sm text-indigo-800">
                <p>
                    <strong>Konsep Baru:</strong> HTMX dan Alpine.js bukan kompetisi, tapi partnership!
                    HTMX menangani server sync (data persistence), Alpine.js menangani UI state (modal, confirm, tabs).
                </p>

                <div class="bg-white rounded p-4 border border-indigo-200 space-y-3">
                    <div>
                        <p class="font-semibold mb-2">ü§ù Perfect Partnership:</p>
                        <ul class="space-y-1 ml-5 text-xs list-disc">
                            <li><strong>Confirm Dialog:</strong> Alpine.js untuk show/hide modal, HTMX untuk actual delete</li>
                            <li><strong>Multi-step Form:</strong> Alpine.js untuk tab navigation, HTMX untuk final submission</li>
                            <li><strong>Client Validation:</strong> Alpine.js validate dulu, baru HTMX submit ke server</li>
                            <li><strong>Optimistic UI:</strong> Alpine.js update UI immediately, HTMX sync ke server</li>
                        </ul>
                    </div>

                    <div>
                        <p class="font-semibold mb-2">‚ö° Pattern yang Digunakan:</p>
                        <table class="w-full text-xs mt-2 border-collapse">
                            <tr class="border-b border-indigo-200 bg-indigo-50">
                                <th class="text-left py-2 px-2">Feature</th>
                                <th class="text-left py-2 px-2">Alpine.js Role</th>
                                <th class="text-left py-2 px-2">HTMX Role</th>
                            </tr>
                            <tr class="border-b border-indigo-100">
                                <td class="py-2 px-2">Delete Confirm</td>
                                <td class="py-2 px-2">Show/hide dialog</td>
                                <td class="py-2 px-2">DELETE request</td>
                            </tr>
                            <tr class="border-b border-indigo-100">
                                <td class="py-2 px-2">Multi-step Form</td>
                                <td class="py-2 px-2">Tab navigation</td>
                                <td class="py-2 px-2">POST final data</td>
                            </tr>
                            <tr class="border-b border-indigo-100">
                                <td class="py-2 px-2">Client Validation</td>
                                <td class="py-2 px-2">Check before submit</td>
                                <td class="py-2 px-2">Submit if valid</td>
                            </tr>
                            <tr>
                                <td class="py-2 px-2">Optimistic UI</td>
                                <td class="py-2 px-2">Update DOM immediately</td>
                                <td class="py-2 px-2">Sync with server</td>
                            </tr>
                        </table>
                    </div>
                </div>

                <div class="bg-white rounded p-3 border border-indigo-200">
                    <p class="font-semibold mb-2">üìÇ Lihat di source code:</p>
                    <ul class="space-y-1 ml-4 text-xs font-mono">
                        <li>üëâ <strong>Controller:</strong> controller/ProjectController.java</li>
                        <li>üëâ <strong>Model:</strong> model/Project.java, repository/ProjectRepository.java</li>
                        <li>üëâ <strong>Modal Form:</strong> templates/fragments/project-form-modal.html</li>
                        <li>üëâ <strong>Todo with Confirm:</strong> templates/fragments/todo-item.html</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Demo 1: Confirm Dialog Before Delete -->
        <div class="card bg-white border-2 border-red-200 mb-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                üéÆ Demo 1: Delete Confirmation (Alpine Modal + HTMX Delete)
            </h3>

            <div class="mb-4 p-3 bg-yellow-50 rounded-lg border border-yellow-300">
                <p class="text-sm text-yellow-900">
                    <strong>üí° Konsep:</strong> Alpine.js menangani modal visibility, HTMX mengirim DELETE request ke server.
                    User tidak bisa accidentally delete tanpa konfirmasi.
                </p>
            </div>

            <div class="p-6 bg-gradient-to-br from-red-50 to-orange-50 rounded-lg border-2 border-red-300">
                <p class="text-sm text-gray-700 mb-4">
                    Coba fitur ini di <strong>Pelajaran 4: Todo List</strong>.
                    Setiap todo item sekarang punya confirm dialog sebelum delete.
                </p>
                <a href="/lesson/4"
                   class="inline-block px-6 py-3 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-600 transition-colors">
                    ‚Üí Lihat Todo List dengan Confirm Dialog
                </a>
            </div>

            <!-- Code Explanation -->
            <div class="mt-4 space-y-4">
                <div>
                    <p class="text-sm font-semibold text-gray-700 mb-2">1. HTML Structure (Alpine manages modal state):</p>
                    <pre class="bg-gray-800 text-gray-100 p-3 rounded text-xs overflow-x-auto"><code>&lt;div x-data="{ showConfirm: false }"&gt;
    &lt;!-- Delete button shows modal --&gt;
    &lt;button @click="showConfirm = true"&gt;üóëÔ∏è Delete&lt;/button&gt;

    &lt;!-- Confirm Modal (Alpine controls visibility) --&gt;
    &lt;div x-show="showConfirm" class="modal-overlay"&gt;
        &lt;div class="modal-content"&gt;
            &lt;h3&gt;Konfirmasi Hapus&lt;/h3&gt;
            &lt;p&gt;Yakin ingin menghapus todo ini?&lt;/p&gt;

            &lt;!-- HTMX handles actual deletion --&gt;
            &lt;button hx-delete="/todos/123"
                    hx-target="#todo-123"
                    hx-swap="outerHTML"
                    @click="showConfirm = false"&gt;
                Ya, Hapus
            &lt;/button&gt;

            &lt;button @click="showConfirm = false"&gt;Batal&lt;/button&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;</code></pre>
                </div>

                <div>
                    <p class="text-sm font-semibold text-gray-700 mb-2">2. Flow Explanation:</p>
                    <ol class="text-xs text-gray-600 space-y-1 ml-5 list-decimal">
                        <li>User klik "Delete" ‚Üí Alpine.js set <code>showConfirm = true</code></li>
                        <li>Modal muncul (x-show) tanpa server request</li>
                        <li>User klik "Ya, Hapus" ‚Üí HTMX kirim DELETE request ke server</li>
                        <li>Server hapus dari database, return empty response</li>
                        <li>HTMX swap element dengan empty (item hilang dari DOM)</li>
                        <li>Alpine.js close modal dengan <code>showConfirm = false</code></li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- Demo 2: Multi-step Form with Alpine Tabs -->
        <div class="card bg-white border-2 border-purple-200 mb-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                üéÆ Demo 2: Multi-Step Project Form (Alpine Tabs + HTMX Submit)
            </h3>

            <div class="mb-4 p-3 bg-yellow-50 rounded-lg border border-yellow-300">
                <p class="text-sm text-yellow-900">
                    <strong>üí° Konsep:</strong> Alpine.js menangani tab navigation dan form state,
                    HTMX mengirim final data ke server saat submit.
                </p>
            </div>

            <!-- Open Modal Button -->
            <div class="p-6 bg-gradient-to-br from-purple-50 to-pink-50 rounded-lg border-2 border-purple-300"
                 x-data="{
                     showModal: false,
                     currentStep: 1,
                     formData: {
                         name: '',
                         description: '',
                         startDate: '',
                         budget: '',
                         priority: 'medium'
                     },
                     canProceed() {
                         if (this.currentStep === 1) return this.formData.name.trim().length >= 3;
                         if (this.currentStep === 2) return this.formData.description.trim().length >= 10;
                         if (this.currentStep === 3) return this.formData.startDate !== '';
                         return true;
                     },
                     resetForm() {
                         this.currentStep = 1;
                         this.formData = {
                             name: '',
                             description: '',
                             startDate: '',
                             budget: '',
                             priority: 'medium'
                         };
                     }
                 }"
                 @project-created.window="showModal = false; resetForm()">
                <button
                    @click="showModal = true"
                    class="px-6 py-3 bg-purple-500 text-white font-semibold rounded-lg hover:bg-purple-600 transition-colors">
                    üìã Buat Project Baru
                </button>

                <!-- Modal Overlay -->
                <div
                    x-show="showModal"
                    x-transition
                    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
                    @click.self="showModal = false">

                    <!-- Modal Content -->
                    <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4"
                         @click.stop>

                        <!-- Modal Header -->
                        <div class="px-6 py-4 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <h3 class="text-xl font-bold text-gray-900">Buat Project Baru</h3>
                                <button
                                    @click="showModal = false"
                                    class="text-gray-400 hover:text-gray-600">
                                    ‚úï
                                </button>
                            </div>

                            <!-- Progress Indicator -->
                            <div class="flex items-center mt-4 space-x-2">
                                <div
                                    :class="currentStep >= 1 ? 'bg-purple-500' : 'bg-gray-300'"
                                    class="h-2 flex-1 rounded transition-colors"></div>
                                <div
                                    :class="currentStep >= 2 ? 'bg-purple-500' : 'bg-gray-300'"
                                    class="h-2 flex-1 rounded transition-colors"></div>
                                <div
                                    :class="currentStep >= 3 ? 'bg-purple-500' : 'bg-gray-300'"
                                    class="h-2 flex-1 rounded transition-colors"></div>
                            </div>
                        </div>

                        <!-- Modal Body (Form Steps) -->
                        <form
                            hx-post="/projects"
                            class="px-6 py-4">

                            <!-- Step 1: Basic Info -->
                            <div x-show="currentStep === 1" class="space-y-4">
                                <h4 class="font-semibold text-gray-900">Step 1: Informasi Dasar</h4>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Nama Project *</label>
                                    <input
                                        type="text"
                                        name="name"
                                        x-model="formData.name"
                                        placeholder="Minimal 3 karakter..."
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                    <p class="text-xs mt-1" :class="formData.name.length >= 3 ? 'text-green-600' : 'text-gray-500'">
                                        <span x-text="formData.name.length"></span>/3 karakter
                                    </p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                                    <select
                                        name="priority"
                                        x-model="formData.priority"
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                        <option value="low">Low</option>
                                        <option value="medium">Medium</option>
                                        <option value="high">High</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Step 2: Description -->
                            <div x-show="currentStep === 2" class="space-y-4">
                                <h4 class="font-semibold text-gray-900">Step 2: Deskripsi</h4>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Deskripsi Project *</label>
                                    <textarea
                                        name="description"
                                        x-model="formData.description"
                                        rows="4"
                                        placeholder="Minimal 10 karakter..."
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"></textarea>
                                    <p class="text-xs mt-1" :class="formData.description.length >= 10 ? 'text-green-600' : 'text-gray-500'">
                                        <span x-text="formData.description.length"></span>/10 karakter
                                    </p>
                                </div>
                            </div>

                            <!-- Step 3: Details -->
                            <div x-show="currentStep === 3" class="space-y-4">
                                <h4 class="font-semibold text-gray-900">Step 3: Detail Project</h4>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Start Date *</label>
                                    <input
                                        type="date"
                                        name="startDate"
                                        x-model="formData.startDate"
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Budget (Rp)</label>
                                    <input
                                        type="number"
                                        name="budget"
                                        x-model="formData.budget"
                                        placeholder="Optional..."
                                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                                </div>

                                <!-- Summary Preview -->
                                <div class="p-4 bg-purple-50 rounded-lg border border-purple-200">
                                    <p class="text-sm font-semibold text-purple-900 mb-2">Review:</p>
                                    <ul class="text-xs text-purple-800 space-y-1">
                                        <li><strong>Nama:</strong> <span x-text="formData.name"></span></li>
                                        <li><strong>Priority:</strong> <span x-text="formData.priority"></span></li>
                                        <li><strong>Deskripsi:</strong> <span x-text="formData.description.substring(0, 50) + '...'"></span></li>
                                        <li><strong>Start Date:</strong> <span x-text="formData.startDate"></span></li>
                                        <li><strong>Budget:</strong> Rp <span x-text="formData.budget || '(tidak diisi)'"></span></li>
                                    </ul>
                                </div>
                            </div>

                            <!-- Navigation Buttons -->
                            <div class="flex justify-between mt-6">
                                <button
                                    type="button"
                                    @click="currentStep > 1 ? currentStep-- : null"
                                    :disabled="currentStep === 1"
                                    :class="currentStep === 1 ? 'opacity-50 cursor-not-allowed' : 'hover:bg-gray-300'"
                                    class="px-6 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg transition-colors">
                                    ‚Üê Previous
                                </button>

                                <!-- Next or Submit -->
                                <button
                                    x-show="currentStep < 3"
                                    type="button"
                                    @click="canProceed() ? currentStep++ : null"
                                    :disabled="!canProceed()"
                                    :class="canProceed() ? 'bg-purple-500 hover:bg-purple-600' : 'bg-gray-300 cursor-not-allowed'"
                                    class="px-6 py-2 text-white font-semibold rounded-lg transition-colors">
                                    Next ‚Üí
                                </button>

                                <button
                                    x-show="currentStep === 3"
                                    type="submit"
                                    :disabled="!canProceed()"
                                    :class="canProceed() ? 'bg-green-500 hover:bg-green-600' : 'bg-gray-300 cursor-not-allowed'"
                                    class="px-6 py-2 text-white font-semibold rounded-lg transition-colors">
                                    ‚úÖ Submit Project
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Project List -->
            <div class="mt-6">
                <h4 class="text-sm font-semibold text-gray-700 mb-3">Project yang sudah dibuat:</h4>
                <div id="project-list"
                     class="space-y-2"
                     hx-get="/projects"
                     hx-trigger="load, refreshProjects from:body"
                     hx-swap="innerHTML">
                    <p class="text-sm text-gray-500 italic">Loading...</p>
                </div>
            </div>

            <!-- Code Explanation -->
            <div class="mt-6 space-y-4">
                <div>
                    <p class="text-sm font-semibold text-gray-700 mb-2">Key Points:</p>
                    <ul class="text-xs text-gray-600 space-y-1 ml-5 list-disc">
                        <li><strong>Alpine.js:</strong> Menangani currentStep, formData state, dan client-side validation</li>
                        <li><strong>x-show:</strong> Toggle step visibility tanpa reload</li>
                        <li><strong>canProceed():</strong> Validate sebelum allow next step</li>
                        <li><strong>HTMX POST:</strong> hx-post="/projects" hanya dipanggil saat final submit</li>
                        <li><strong>HTMX GET:</strong> hx-get="/projects" dengan hx-trigger="load" untuk load project list</li>
                        <li><strong>HX-Trigger Header:</strong> Server mengirim event "projectCreated, refreshProjects"</li>
                        <li><strong>Event Handling:</strong> Alpine close modal, HTMX refresh list dari server</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Key Takeaways -->
        <div class="card bg-green-50 border-l-4 border-green-500 mb-6">
            <h3 class="text-lg font-semibold text-green-900 mb-3">‚úÖ Poin Penting Pelajaran 7</h3>
            <ul class="space-y-2 text-sm text-green-800">
                <li class="flex items-start">
                    <span class="mr-2">‚Ä¢</span>
                    <span><strong>HTMX + Alpine = Perfect Team</strong> - HTMX untuk server sync, Alpine untuk UI state</span>
                </li>
                <li class="flex items-start">
                    <span class="mr-2">‚Ä¢</span>
                    <span><strong>Confirm Dialog Pattern</strong> - Alpine show modal, HTMX handle actual operation</span>
                </li>
                <li class="flex items-start">
                    <span class="mr-2">‚Ä¢</span>
                    <span><strong>Multi-step Forms</strong> - Alpine untuk navigation, HTMX untuk final submission</span>
                </li>
                <li class="flex items-start">
                    <span class="mr-2">‚Ä¢</span>
                    <span><strong>Client-side Validation</strong> - Alpine validate before HTMX submit (better UX)</span>
                </li>
                <li class="flex items-start">
                    <span class="mr-2">‚Ä¢</span>
                    <span><strong>HX-Trigger Header</strong> - Server trigger multiple events (projectCreated, refreshProjects) untuk koordinasi client actions</span>
                </li>
                <li class="flex items-start">
                    <span class="mr-2">‚Ä¢</span>
                    <span><strong>List Refresh Pattern</strong> - POST trigger event, GET reload full list untuk consistency</span>
                </li>
                <li class="flex items-start">
                    <span class="mr-2">‚Ä¢</span>
                    <span><strong>Progressive Enhancement</strong> - Form masih works tanpa JavaScript</span>
                </li>
                <li class="flex items-start">
                    <span class="mr-2">‚Ä¢</span>
                    <span><strong>Best of Both Worlds</strong> - Instant UI feedback + reliable server persistence</span>
                </li>
            </ul>
        </div>

        <!-- Navigation -->
        <div class="flex justify-between">
            <a href="/lesson/6"
               class="px-6 py-3 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition-colors">
                ‚Üê Pelajaran 6
            </a>
            <a href="/lesson/8"
               class="px-6 py-3 bg-gray-300 text-gray-500 font-semibold rounded-lg cursor-not-allowed">
                Pelajaran 8 (Coming Soon) ‚Üí
            </a>
        </div>
    </div>
</body>
</html>
