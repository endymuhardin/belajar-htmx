<!DOCTYPE html>
<html lang="id" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>Pelajaran 9: File Upload</title>
</head>
<body>
    <div layout:fragment="content">
        <!-- Lesson Header -->
        <div class="mb-6">
            <div class="flex items-center space-x-3 mb-2">
                <span class="text-4xl">9Ô∏è‚É£</span>
                <h2 class="text-3xl font-bold text-gray-900">Pelajaran 9: File Upload dengan HTMX</h2>
            </div>
            <p class="text-gray-600 text-lg">
                Upload file dengan <code class="bg-gray-200 px-2 py-1 rounded text-sm">hx-post</code>,
                <code class="bg-gray-200 px-2 py-1 rounded text-sm">hx-encoding="multipart/form-data"</code>,
                dan progress indicator
            </p>
        </div>

        <!-- Lesson Overview -->
        <div class="card bg-indigo-50 border-l-4 border-indigo-500 mb-6">
            <h3 class="text-xl font-bold text-indigo-900 mb-3">üìö Konsep Pelajaran 9</h3>

            <div class="space-y-3 text-sm text-indigo-800">
                <p>
                    <strong>Konsep Baru:</strong> File upload adalah fitur umum dalam web apps. HTMX
                    memungkinkan upload file via AJAX tanpa reload page, dengan progress indicator.
                </p>

                <div class="bg-white rounded p-4 border border-indigo-200 space-y-3">
                    <div>
                        <p class="font-semibold mb-2">üì§ File Upload Pattern:</p>
                        <ul class="space-y-1 ml-5 text-xs list-disc">
                            <li><code class="bg-indigo-100 px-1 rounded">hx-post="/documents/upload"</code> - POST ke upload endpoint</li>
                            <li><code class="bg-indigo-100 px-1 rounded">hx-encoding="multipart/form-data"</code> - Required untuk file upload</li>
                            <li><code class="bg-indigo-100 px-1 rounded">hx-indicator="#progress"</code> - Show progress saat upload</li>
                            <li>Server return updated list setelah upload berhasil</li>
                        </ul>
                    </div>

                    <div>
                        <p class="font-semibold mb-2">‚ö° Keuntungan File Upload dengan HTMX:</p>
                        <ul class="space-y-1 ml-5 text-xs list-disc">
                            <li>No page reload - smooth user experience</li>
                            <li>Progress indicator untuk long uploads</li>
                            <li>Instant feedback setelah upload</li>
                            <li>Easy validation dan error handling</li>
                        </ul>
                    </div>

                    <div>
                        <p class="font-semibold mb-2">üéØ Features yang Diimplementasi:</p>
                        <ul class="space-y-1 ml-5 text-xs list-disc">
                            <li>‚úÖ Single file upload dengan description</li>
                            <li>‚úÖ File list dengan download links</li>
                            <li>‚úÖ Delete file dengan hx-delete</li>
                            <li>‚úÖ File size formatting dan metadata</li>
                        </ul>
                    </div>
                </div>

                <div class="bg-white rounded p-3 border border-indigo-200">
                    <p class="font-semibold mb-2">üìÇ Lihat di source code:</p>
                    <ul class="space-y-1 ml-4 text-xs font-mono">
                        <li>üëâ <strong>Model:</strong> model/Document.java</li>
                        <li>üëâ <strong>Repository:</strong> repository/DocumentRepository.java</li>
                        <li>üëâ <strong>Service:</strong> service/FileStorageService.java</li>
                        <li>üëâ <strong>Controller:</strong> controller/DocumentController.java</li>
                        <li>üëâ <strong>Page:</strong> templates/document-list.html</li>
                        <li>üëâ <strong>Fragment:</strong> templates/fragments/upload-result.html</li>
                        <li>üëâ <strong>Migration:</strong> db/migration/V4__create_documents_table.sql</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- How it Works -->
        <div class="card bg-purple-50 border-l-4 border-purple-500 mb-6">
            <h3 class="text-lg font-semibold text-purple-900 mb-3">
                ‚öôÔ∏è Cara Kerja File Upload
            </h3>

            <div class="space-y-3 text-sm text-purple-800">
                <div class="bg-white rounded p-4 border border-purple-200">
                    <p class="font-semibold mb-2">üìä Flow Diagram:</p>
                    <pre class="bg-gray-800 text-gray-100 p-3 rounded text-xs overflow-x-auto"><code>1. User pilih file via &lt;input type="file"&gt;
   ‚Üí User bisa tambah description (optional)

2. User klik Upload button
   ‚Üí Form submit dengan hx-post
   ‚Üí HTMX set encoding ke multipart/form-data
   ‚Üí Progress indicator muncul

3. Server receive file
   ‚Üí FileStorageService save file ke disk
   ‚Üí Generate unique filename (UUID)
   ‚Üí Save metadata ke database

4. Server return fragment
   ‚Üí Success message + updated document list
   ‚Üí HTMX swap content ke target
   ‚Üí Form di-reset untuk upload berikutnya</code></pre>
                </div>

                <div class="bg-white rounded p-4 border border-purple-200">
                    <p class="font-semibold mb-2">üîç Key HTMX Attributes:</p>
                    <table class="w-full text-xs mt-2 border-collapse">
                        <tr class="border-b border-purple-200 bg-purple-50">
                            <th class="text-left py-2 px-2">Attribute</th>
                            <th class="text-left py-2 px-2">Value</th>
                            <th class="text-left py-2 px-2">Fungsi</th>
                        </tr>
                        <tr class="border-b border-purple-100">
                            <td class="py-2 px-2 font-mono">hx-post</td>
                            <td class="py-2 px-2 font-mono">"/documents/upload"</td>
                            <td class="py-2 px-2">Upload endpoint</td>
                        </tr>
                        <tr class="border-b border-purple-100">
                            <td class="py-2 px-2 font-mono">hx-encoding</td>
                            <td class="py-2 px-2 font-mono">"multipart/form-data"</td>
                            <td class="py-2 px-2">Required untuk file upload</td>
                        </tr>
                        <tr class="border-b border-purple-100">
                            <td class="py-2 px-2 font-mono">hx-target</td>
                            <td class="py-2 px-2 font-mono">"#upload-result"</td>
                            <td class="py-2 px-2">Where to show result</td>
                        </tr>
                        <tr>
                            <td class="py-2 px-2 font-mono">hx-indicator</td>
                            <td class="py-2 px-2 font-mono">"#progress"</td>
                            <td class="py-2 px-2">Show progress during upload</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <!-- Code Explanation -->
        <div class="card bg-gray-50 border-l-4 border-gray-400 mb-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-3">
                üìù Penjelasan Kode
            </h3>

            <div class="space-y-4">
                <div>
                    <p class="text-sm font-semibold text-gray-700 mb-2">1. Document Entity:</p>
                    <pre class="bg-gray-800 text-gray-100 p-3 rounded text-xs overflow-x-auto"><code>@Entity
@Table(name = "documents")
public class Document {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String originalFilename;  // Nama asli file
    private String storedFilename;    // UUID filename di disk
    private String contentType;       // MIME type
    private Long fileSize;            // Size dalam bytes
    private String description;       // User description
    private LocalDateTime uploadedAt;
}</code></pre>
                </div>

                <div>
                    <p class="text-sm font-semibold text-gray-700 mb-2">2. FileStorageService:</p>
                    <pre class="bg-gray-800 text-gray-100 p-3 rounded text-xs overflow-x-auto"><code>@Service
public class FileStorageService {
    private final Path fileStorageLocation = Paths.get("uploads");

    public String storeFile(MultipartFile file) {
        // Generate unique filename
        String storedFilename = UUID.randomUUID().toString() + extension;

        // Copy file to disk
        Files.copy(file.getInputStream(), targetLocation);

        return storedFilename;
    }
}</code></pre>
                </div>

                <div>
                    <p class="text-sm font-semibold text-gray-700 mb-2">3. Upload Controller:</p>
                    <pre class="bg-gray-800 text-gray-100 p-3 rounded text-xs overflow-x-auto"><code>@PostMapping("/documents/upload")
public String uploadDocument(
        @RequestParam("file") MultipartFile file,
        @RequestParam("description") String description) {

    // Save file to disk
    String storedFilename = fileStorageService.storeFile(file);

    // Save metadata to database
    Document document = new Document();
    document.setOriginalFilename(file.getOriginalFilename());
    document.setStoredFilename(storedFilename);
    documentRepository.save(document);

    // Return success fragment
    return "fragments/upload-result";
}</code></pre>
                </div>

                <div>
                    <p class="text-sm font-semibold text-gray-700 mb-2">4. Upload Form (HTML):</p>
                    <pre class="bg-gray-800 text-gray-100 p-3 rounded text-xs overflow-x-auto"><code>&lt;form hx-post="/documents/upload"
      hx-encoding="multipart/form-data"
      hx-target="#upload-result"
      hx-indicator="#progress"&gt;

    &lt;input type="file" name="file" required&gt;
    &lt;input type="text" name="description" placeholder="Description"&gt;
    &lt;button type="submit"&gt;Upload&lt;/button&gt;

    &lt;div id="progress" class="htmx-indicator"&gt;
        Uploading...
    &lt;/div&gt;
&lt;/form&gt;

&lt;div id="upload-result"&gt;&lt;/div&gt;</code></pre>
                </div>
            </div>
        </div>

        <!-- Demo Link -->
        <div class="card bg-white border-2 border-indigo-200 mb-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                üéÆ Demo Interaktif: Document Upload
            </h3>

            <div class="mb-4 p-3 bg-yellow-50 rounded-lg border border-yellow-300">
                <p class="text-sm text-yellow-900">
                    <strong>üí° Cara Test:</strong>
                </p>
                <ul class="mt-2 ml-5 text-sm text-yellow-800 space-y-1 list-disc text-left">
                    <li>Klik tombol di bawah untuk buka Document Manager</li>
                    <li>Pilih file untuk upload (gambar, PDF, dokumen, dll)</li>
                    <li>Tambahkan description (optional)</li>
                    <li>Perhatikan progress indicator saat upload (2s delay untuk demo)</li>
                    <li>File akan muncul di list dengan download link</li>
                    <li>Test delete file dengan hx-delete</li>
                    <li>Open browser DevTools Network tab untuk lihat requests</li>
                </ul>
            </div>

            <div class="text-center">
                <a href="/documents"
                   class="inline-block px-8 py-4 bg-indigo-600 text-white font-bold text-lg rounded-lg hover:bg-indigo-700 transition-colors shadow-lg">
                    üì§ Buka Document Manager ‚Üí
                </a>
            </div>
        </div>

        <!-- Key Takeaways -->
        <div class="card bg-green-50 border-l-4 border-green-500 mb-6">
            <h3 class="text-lg font-semibold text-green-900 mb-3">‚úÖ Poin Penting Pelajaran 9</h3>
            <ul class="space-y-2 text-sm text-green-800">
                <li class="flex items-start">
                    <span class="mr-2">‚Ä¢</span>
                    <span><strong>hx-encoding="multipart/form-data"</strong> - Wajib untuk file upload</span>
                </li>
                <li class="flex items-start">
                    <span class="mr-2">‚Ä¢</span>
                    <span><strong>MultipartFile</strong> - Spring Boot interface untuk handle uploaded files</span>
                </li>
                <li class="flex items-start">
                    <span class="mr-2">‚Ä¢</span>
                    <span><strong>FileStorageService</strong> - Separate concern untuk file I/O operations</span>
                </li>
                <li class="flex items-start">
                    <span class="mr-2">‚Ä¢</span>
                    <span><strong>UUID filename</strong> - Prevent conflicts dan security issues</span>
                </li>
                <li class="flex items-start">
                    <span class="mr-2">‚Ä¢</span>
                    <span><strong>Progress indicator</strong> - Better UX untuk long operations</span>
                </li>
                <li class="flex items-start">
                    <span class="mr-2">‚Ä¢</span>
                    <span><strong>Download endpoint</strong> - Serve files dengan proper content-type</span>
                </li>
                <li class="flex items-start">
                    <span class="mr-2">‚Ä¢</span>
                    <span><strong>Delete dengan hx-delete</strong> - Remove file dari disk dan database</span>
                </li>
            </ul>
        </div>

        <!-- Navigation -->
        <div class="flex justify-between">
            <a href="/lesson/8"
               class="px-6 py-3 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition-colors">
                ‚Üê Pelajaran 8
            </a>
            <a href="/lesson/10"
               class="px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition-colors">
                Pelajaran 10 ‚Üí
            </a>
        </div>
    </div>
</body>
</html>
